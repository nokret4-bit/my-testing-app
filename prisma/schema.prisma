generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model booking {
  id            String        @id
  code          String        @unique
  userId        String?
  facilityId    String
  startDate     DateTime
  endDate       DateTime
  guests        Int           @default(1)
  status        BookingStatus @default(PENDING)
  customerName  String
  customerEmail String
  customerPhone String?
  totalAmount   Decimal       @db.Decimal(10, 2)
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  confirmedAt   DateTime?
  cancelledAt   DateTime?
  facility      facility      @relation(fields: [facilityId], references: [id])
  user          user?         @relation(fields: [userId], references: [id])
  payment       payment?

  @@index([code])
  @@index([customerEmail])
  @@index([facilityId, startDate, endDate])
  @@index([status])
}

model facility {
  id          String       @id
  name        String
  kind        FacilityKind
  description String?
  capacity    Int
  price       Decimal      @db.Decimal(10, 2)
  photos      String[]
  amenities   String[]
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  bookings    booking[]

  @@index([isActive])
  @@index([kind])
}

model payment {
  id            String        @id
  bookingId     String        @unique
  amount        Decimal       @db.Decimal(10, 2)
  status        PaymentStatus @default(PENDING)
  paymentMethod String?
  transactionId String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  paidAt        DateTime?
  booking       booking       @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([transactionId])
}

model user {
  id            String          @id
  name          String
  email         String          @unique
  phone         String?
  passwordHash  String?
  role          Role            @default(GUEST)
  isActive      Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  bookings      booking[]
  auditLogs     auditLog[]

  @@index([email])
  @@index([role])
}

model auditLog {
  id        String       @id @default(cuid())
  userId    String
  action    String
  entity    String // "Booking", "Facility", "User", "Payment"
  entityId  String
  data      Json? // Store additional data like old/new values
  createdAt DateTime     @default(now())
  user      user         @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([entity])
  @@index([createdAt])
}

enum ActivityType {
  LOGIN
  LOGOUT
  CREATE_BOOKING
  UPDATE_BOOKING
  DELETE_BOOKING
  CHECKIN_BOOKING
  CHECKOUT_BOOKING
  CREATE_FACILITY
  UPDATE_FACILITY
  DELETE_FACILITY
  CREATE_USER
  UPDATE_USER
  DELETE_USER
  CREATE_PAYMENT
  UPDATE_PAYMENT
  DELETE_PAYMENT
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum FacilityKind {
  ROOM
  COTTAGE
  HALL
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum Role {
  GUEST
  STAFF
  ADMIN
}
